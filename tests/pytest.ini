[pytest]
# Pytest Configuration for SymphAIny Platform
# Aligned with Testing Strategy Overhaul Plan

# Python path configuration - automatically adds these paths to sys.path
pythonpath = 
    ../symphainy-platform
    .
    ${PYTHONPATH}

# Test discovery
testpaths = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Command line options
addopts =
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --asyncio-mode=auto
    --color=yes
    -ra
    --timeout=60
    --timeout-method=thread

# Test markers (aligned with Testing Strategy Overhaul Plan)
markers =
    # Test types
    unit: Unit tests (fast, isolated)
    integration: Integration tests (multiple components)
    e2e: End-to-end tests (full platform)
    functional: Functional business logic tests
    smoke: Quick smoke tests
    contract: Contract validation tests
    performance: Performance tests
    
    # Component categories
    foundations: Foundation layer tests
    smart_city: Smart City service tests
    journey: Journey realm tests
    solution: Solution realm tests
    pillar: Pillar tests (general)
    content: Content pillar tests
    insights: Insights pillar tests
    operations: Operations pillar tests
    business_outcomes: Business Outcomes pillar tests
    orchestrators: Orchestrator tests
    agents: Agent tests
    managers: Manager tests
    
    # Speed markers
    fast: Fast tests (< 1 second)
    slow: Slow tests (> 1 second)
    
    # Timeout markers
    timeout_10: Test with 10 second timeout
    timeout_30: Test with 30 second timeout
    timeout_60: Test with 60 second timeout
    timeout_120: Test with 120 second timeout
    timeout_300: Test with 300 second timeout (5 minutes)
    
    # Priority markers
    critical: Critical tests (must pass for production)
    critical_infrastructure: Critical infrastructure tests
    
    # AI/Agent markers
    ai: Tests using real AI APIs (slow, costs money)
    real_llm: Tests using real LLM calls (slow, costs money)
    cached: Tests using cached AI responses
    costs_money: Tests that incur API costs
    
    # Special categories
    security: Security-related tests
    chaos: Chaos engineering tests
    websocket: WebSocket connection tests
    production_readiness: Production readiness tests
    saga: Saga pattern tests
    wal: WAL pattern tests
    embedding: Embedding/data mash tests
    data_mash: Data mash workflow tests
    semantic_layer: Semantic layer tests

# Warnings filter
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestUnraisableExceptionWarning

# Logging
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Coverage (if pytest-cov is installed)
[coverage:run]
source = ../symphainy-platform
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */migrations/*
    */archive/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

[coverage:html]
directory = htmlcov

