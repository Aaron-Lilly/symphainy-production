[pytest]
# Pytest Configuration for SymphAIny Platform (New Architecture)

# Python path configuration - automatically adds these paths to sys.path before importing tests
# This is the BEST PRACTICE approach - no need for per-file sys.path manipulation
pythonpath = 
    ../symphainy-platform
    .

# Test discovery
testpaths = .
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Command line options
addopts =
    -v
    --tb=short
    --strict-markers
    --disable-warnings
    --asyncio-mode=auto
    --color=yes
    -ra
    --timeout=60
    --timeout-method=thread

# Test markers
markers =
    smoke: Critical smoke tests that must pass for production
    critical: Critical tests for production readiness
    cto_demo: CTO demo scenario tests
    api_contract: API contract validation tests
    playwright_e2e: Playwright browser automation E2E tests
    # Test types
    unit: Unit tests (fast, isolated)
    integration: Integration tests (multiple components)
    e2e: End-to-end tests (full platform)
    functional: Functional business logic tests
    smoke: Quick smoke tests
    reality: Reality vs test gap tests
    
    # Component categories (Layer markers)
    infrastructure: Infrastructure adapter tests (Layer 0)
    foundations: Foundation layer tests (Layer 1)
    smart_city: Smart City service tests (Layer 2)
    business_enablement: Business Enablement realm tests (Layer 4)
    enabling_services: Enabling service tests (Layer 3)
    orchestrators: Orchestrator tests (Layer 4)
    mcp: MCP server tests (Layer 5)
    agents: Agent tests (Layer 6)
    bases: Base class tests
    
    # Speed markers
    fast: Fast tests (< 1 second)
    slow: Slow tests (> 1 second)
    
    # Timeout markers (pytest-timeout)
    timeout_10: Test with 10 second timeout
    timeout_30: Test with 30 second timeout
    timeout_60: Test with 60 second timeout
    timeout_120: Test with 120 second timeout
    timeout_300: Test with 300 second timeout (5 minutes)
    timeout_600: Test with 600 second timeout (10 minutes)
    
    # Priority markers
    critical: Critical tests (must pass for production)
    critical_infrastructure: Critical infrastructure tests (run first, prevent SSH issues)
    
    # AI/Agent markers
    ai: Tests using real AI APIs (slow, costs money)
    real_llm: Tests using real LLM calls (slow, costs money)
    cached: Tests using cached AI responses
    costs_money: Tests that incur API costs
    
    # Special categories
    security: Security-related tests
    performance: Performance tests
    chaos: Chaos engineering tests
    websocket: WebSocket connection tests
    production_readiness: Production readiness tests
    
    # Realm/Pillar markers
    insights: Insights pillar tests
    content: Content pillar tests
    operations: Operations pillar tests
    solution: Solution realm tests
    journey: Journey realm tests
    architecture: Architecture flow tests
    data_mash: Data mash and query insights tests (Phase 4)

# Warnings filter
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::pytest.PytestUnraisableExceptionWarning

# Logging
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Coverage (if pytest-cov is installed)
[coverage:run]
source = symphainy-platform
omit =
    */tests/*
    */test_*.py
    */__pycache__/*
    */migrations/*
    */archive/*
    */archived_*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

[coverage:html]
directory = htmlcov

